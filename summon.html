<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="game">
  <div class="innergame" id="innergame">
    <p id = "quartz"> Saint Quartz:</p>
    <img id="rateUpImage" style="" src="assets/images/rateup1.jpg" height="450" width="800">
    <img id="summonImage" style="display: none" src="https://media.giphy.com/media/l3V0gHdi1hRHHaQa4/giphy.gif" height="450" width="800">
    <img id="avatar" style="display: none" src="assets/images/avatars/strife.png" height="" width="">
    <p id="name" style="font-weight: 800; font-size: 48px"></p>
    <p id="rating" style="font-weight: 800; font-size: 12px; color: white";></p>
    <p id="class" style="font-weight: 800; font-size: 12px; color: white;"></p>
    <p id="NP" style="font-weight: 800; font-size: 12px; color: white;"></p>
    <p id="quote" style="font-weight: 800; font-size: 12px; color: grey;"></p>
    </br>
    <button type="button" id="summonButton" style="display: true" onclick="summon()">Summon</button></br>
    <button type="button" id="myroomButton" style="display: true" onclick="showMyroom()">My Room</button>
    <button type="button" id="servantListButton" style="display: true" onclick="showServantList()">Spirit Origin List (Servant List)</button>
    </br>
  </div>
  <div class="myroom" id="myroom" style="display: none">
      <div class="myroominner">
        My Room.
        Pick the servant for Your Room:
        <form>
            <select id="myroomSelect" onchange="updateMyroom()">
            </select>
        </form>
        <img id="myroomAvatar" style="display: none" src="assets/images/avatars/strife.png" height="" width="">
      </div>
      <div class="myroomtext">
        <p id="myroomName" style="font-weight: 800; font-size: 24px"></p>
        <p id="myroomRating" style="font-weight: 800; font-size: 12px; color: white";></p>
        <p id="myroomClass" style="font-weight: 800; font-size: 12px; color: white;"></p>
        <p id="myroomNP" style="font-weight: 800; font-size: 12px; color: white;"></p>
        <p id="myroomQuote" style="font-weight: 800; font-size: 12px; color: grey;"></p>
        <button type="button" id="hideMyroomButton" onclick="hideMyroom()">Back to Summoning</button>
     </div>
  </div>
  <div class="servantList" id="servantList" style="display: none">
      <div class="servantListInner">
          <p id = "servantsOwned">Servants Owned:</p>
          <button type="button" id="hideServantListButton" onclick="hideServantList()">Back to Summoning</button>
  </div>
</div>

</body>
</html>

<script>

  var summonSound = new Audio('assets/music/summonsound.mp3');

  var quartz = JSON.parse(localStorage.getItem('blgo_quartz')) || 85;
  var owned = JSON.parse(localStorage.getItem('blgo_save')) || [];
  var result;

  populateMyroom();

  document.getElementById("quartz").innerHTML = ("Saint Quartz: " + (quartz));

  function summon() {
    if (quartz > 0) {
        document.getElementById("rateUpImage").style.display= "none";
        result = users[Math.floor((Math.random() * users.length))]
        var name = String(result);
        showAndHideSummoningElements(name, result);
        quartz--;
        document.getElementById("servantsOwned").innerHTML = "Servants Owned: </br>" + (listServants().join(", "));
        localStorage.setItem('blgo_save', JSON.stringify(owned));
        localStorage.setItem('blgo_quartz', JSON.stringify(quartz));
    };
  }

  function listServants() {
    var unique = owned.filter(function(elem, index, self) {
      return index === self.indexOf(elem);
    })
    return unique;
  }

  function populateMyroom() {
    var x = document.getElementById("myroomSelect");
    while (x.firstChild) {
      x.removeChild(x.firstChild);
}
    var a = listServants();
    for (var index = 0; index < a.length; index++) {
        var option = document.createElement("option");
        option.text = a[index];
        x.add(option, x[index]);
    }
  }

  function showMyroom() {
    populateMyroom();
    document.getElementById("myroom").style.display = ("");
    document.getElementById("innergame").style.display = ("none");
  }

  function hideMyroom() {
    document.getElementById("myroom").style.display = ("none");
    document.getElementById("innergame").style.display = ("");
  }

  function showServantList() {
    document.getElementById("servantsOwned").innerHTML = "<b>Servants Owned</b>: </br>" + (listServants().join(", "));
    document.getElementById("servantList").style.display = ("");
    document.getElementById("innergame").style.display = ("none");
  }

  function hideServantList() {
    document.getElementById("servantList").style.display = ("none");
    document.getElementById("innergame").style.display = ("");
  }

  function updateMyroom() {
    document.getElementById("myroomName").style.color = ("");
    var selectedServant = document.getElementById("myroomSelect").value;
    document.getElementById("myroomName").innerHTML = selectedServant;
    if (servants[selectedServant].avatar == "yes") {
      document.getElementById("myroomAvatar").src = "assets/images/avatars/" + selectedServant.toLowerCase() + ".png";
    }
    else if (servants[selectedServant].avatar == "gif") {
      document.getElementById("myroomAvatar").src = "assets/images/avatars/" + selectedServant.toLowerCase() + ".gif";
    }
    else if (servants[selectedServant].avatar == "jpg") {
      document.getElementById("myroomAvatar").src = "assets/images/avatars/" + selectedServant.toLowerCase() + ".jpg";
    }
    else if (servants[selectedServant].avatar == "banned") {
      document.getElementById("myroomAvatar").src = "assets/images/avatars/unknown.gif";
    }
    else {
      document.getElementById("myroomAvatar").src = "assets/images/avatars/unknown.gif";
    }

    if (servants[selectedServant].class == "Moderator") {
      document.getElementById("myroomName").style.color = ("#40FF40");
    } 
    else if (servants[selectedServant].class == "Admin") {
      document.getElementById("myroomName").style.color = ("#00FFFF");
    }
    else if (servants[selectedServant].class == "Avenger") {
      document.getElementById("myroomName").style.color = ("red");
    }

    document.getElementById("myroomQuote").innerHTML = servants[selectedServant].quote || "";
    document.getElementById("myroomNP").innerHTML = "Noble Phantasm Rank: " + countInArray(owned, selectedServant);
    document.getElementById("myroomAvatar").style.display = ("");
    document.getElementById("myroomClass").innerHTML = "Class: " + servants[selectedServant].class;
    document.getElementById("myroomRating").innerHTML = "Star Rating: " + servants[selectedServant].rating;
  }

  function showAndHideSummoningElements(name, result){
    summonSound.play();
    document.getElementById("name").innerHTML = result;
    document.getElementById("class").innerHTML = "Class: " + servants[name].class;
    document.getElementById("rating").innerHTML = "Star Rating: " + servants[name].rating;
    document.getElementById("quote").innerHTML = servants[name].quote || "";
    document.getElementById("quartz").innerHTML = ("Saint Quartz: " + (quartz - 1));

    document.getElementById("name").style.color = ("");
    document.getElementById("name").style.textDecoration = (""); 
    document.getElementById("name").style.display = ("none");
    document.getElementById("rating").style.display = ("none");
    document.getElementById("quote").style.display = ("none");
    document.getElementById("class").style.display = ("none");
    document.getElementById("summonImage").style.display = ("");
    document.getElementById("summonButton").style.display = ("none");
    document.getElementById("myroomButton").style.display = ("none");
    document.getElementById("servantListButton").style.display = ("none");
    document.getElementById("servantsOwned").style.display = ("none");
    document.getElementById("avatar").style.display = ("none");
    document.getElementById("NP").style.display = ("none");
    if (servants[name].avatar == "yes") {
      document.getElementById("avatar").src = "assets/images/avatars/" + name.toLowerCase() + ".png";
    }
    else if (servants[name].avatar == "gif") {
      document.getElementById("avatar").src = "assets/images/avatars/" + name.toLowerCase() + ".gif";
    }
    else if (servants[name].avatar == "jpg") {
      document.getElementById("avatar").src = "assets/images/avatars/" + name.toLowerCase() + ".jpg";
    }
    else if (servants[name].avatar == "banned") {
      document.getElementById("avatar").src = "assets/images/avatars/unknown.gif";
      document.getElementById("name").style.color = ("red");
      document.getElementById("name").style.textDecoration = ("line-through"); 
    }
    else {
      document.getElementById("avatar").src = "assets/images/avatars/unknown.gif";
    }

    if (servants[name].class == "Moderator") {
      document.getElementById("avatar").src = "assets/images/avatars/" + name.toLowerCase() + ".png";
      document.getElementById("name").style.color = ("#40FF40");
    } 
    else if (servants[name].class == "Admin") {
      document.getElementById("avatar").src = "assets/images/avatars/" + name.toLowerCase() + ".png";
      document.getElementById("name").style.color = ("#00FFFF");
    }

    var imageHidden;

    setTimeout(function(){
      document.getElementById("summonImage").style.display= imageHidden ? "" : "none";
      document.getElementById("name").style.display= imageHidden ? "none" : "";
      document.getElementById("rating").style.display= imageHidden ? "none" : "";
      document.getElementById("class").style.display= imageHidden ? "none" : "";
      document.getElementById("quote").style.display= imageHidden ? "none" : "";
      document.getElementById("servantsOwned").style.display= imageHidden ? "none" : "";
      document.getElementById("summonButton").style.display= imageHidden ? "none" : "";
      document.getElementById("myroomButton").style.display= imageHidden ? "none" : "";
      document.getElementById("servantListButton").style.display= imageHidden ? "none" : "";
      document.getElementById("avatar").style.display= imageHidden ? "none" : "";
      document.getElementById("NP").style.display= imageHidden ? "none" : "";
      imageHidden = !imageHidden;
      owned.push(result);
      document.getElementById("NP").innerHTML = "Noble Phantasm Rank: " + countInArray(owned, name);
    }, 2185);
  }

function countInArray(array, what) {
    var count = 0;
    for (var i = 0; i < array.length; i++) {
        if (array[i] === what) {
            count++;
        }
    }
    if (count < 5) {
      return count;
    }
    else {
      return 5;
    }
}


var users = [
  "Strife", "Spinach", "Kirby", "SeiKeo", "i3uster", "Seika",
  "Macchaos", "Petrikow", "Bridge", "Christemo", "Marma", "Nihilm",
  "Five_X", "Bloble", "Katie", "Cruor", "McJon", "Paitouch", "Lianru",
  "Arashi_Leonheart", "Snow", "Frosty", "Frantic", "Mooncake", "Nachos",
  "SpoonyViking", "Skull", "Draconic", "LVL", "Kotonoha", "Kyte",
  "Eddyak", "HenIchi", "LJ3", "Trubo", "Food", "Mike", "Crying Vegeta",
  "Polly", "Dartz", "You", "Sesto", "Tobias"
];

var servants = {
        "Strife": {
          "rating": "* * * * *",
          "class": "Forumite",
          "quote": "'Winky face ;)'",
          "avatar": "yes"
        },
        "Spinach": {
          "rating": "* * * *",
          "class": "Moderator",
          "quote": "'Do it, you wont'",
          "avatar": "yes"
        },
        "SeiKeo": {
          "rating": "* * * *",
          "class": "Former Moderator",
          "quote": "'What is Smart Anime.'",
          "avatar": "yes"
        },
        "i3uster": {
          "rating": "* * * *",
          "class": "Moderator",
          "quote": "'weed XD'",
          "avatar": "yes"
        },
        "Five_X": {
          "rating": "* * * *",
          "class": "Moderator",
          "avatar": "yes"
        },
        "Kirby": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'welp'",
          "avatar": "yes"
        },
        "Seika": {
          "rating": "* * * * *",
          "class": "Admin",
          "quote": "'My tutor had to ask me if I actually worshipped Dionysus.'",
          "avatar": "yes"
        },
        "Tobias": {
          "rating": "* * * * *",
          "class": "Admin",
          "quote": "'No Zero, please.'",
          "avatar": "jpg"
        },
        "Macchaos": {
          "rating": "* * * * *",
          "class": "Admin",
          "quote": "'looool'",
          "avatar": "yes"
        },
        "Petrikow": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'Malk'",
          "avatar": "banned"
        },
        "Bridge": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'This is just like in Harry Potter when they get the names out of the goblet of fire.'",
          "avatar": "banned"
        },
        "Christemo": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'Dank memes'",
          "avatar": "banned"
        },
        "Marma": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "gif"
        },
        "Nihilm": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'I miss Bridge'",
          "avatar": "jpg"
        },
        "Bloble": {
          "rating": "*",
          "class": "Forumite",
          "quote": "'This is what you deserve'",
          "avatar": "yes"
        },
        "Katie": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Cruor": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "McJon": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'haha we're just platonic friends'",
          "avatar": "yes"
        },
        "Paitouch": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'Only took 650 quartz for NP5.'",
          "avatar": "yes"
        },
        "Lianru": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Arashi_Leonheart": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Snow": {
          "rating": "* * * *",
          "class": "Moderator",
          "quote": "여보세요",
          "avatar": "yes"
        },
        "Frosty": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'I found a crowbar.'",
          "avatar": "jpg"
        },
        "Frantic": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Mooncake": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Nachos": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'See me in Blazblue'",
          "avatar": "yes"
        },
        "SpoonyViking": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Skull": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "jpg"
        },
        "Draconic": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "jpg"
        },
        "LVL": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Kotonoha": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'omegaverse shinji'",
          "avatar": "yes"
        },
        "Kyte": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Eddyak": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "jpg"
        },
        "LJ3": {
          "rating": "* * *",
          "class": "Forumite"
        },
        "Trubo": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "gif"
        },
        "HenIchi": {
          "rating": "* * *",
          "class": "Forumite",
          "avatar": "yes"
        },
        "Dartz": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'Arc is stronger.'"
        },
        "Food": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'Waifufags.'",
          "avatar": "banned"
        },
        "Mike": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'Erm, what?'",
          "avatar": "banned"
        },
        "Crying Vegeta": {
          "rating": "* * * * *",
          "class": "Avenger",
          "quote": "'get out'",
          "avatar": "banned"
        },
        "Polly": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "Приве́т.",
          "avatar": "jpg"
        },
        "You": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'Ogre like'",
          "avatar": "yes"
        },
        "Sesto": {
          "rating": "* * *",
          "class": "Forumite",
          "quote": "'Every day I wake up and remember Marie isn't real.'",
          "avatar": "yes"
        }
 }

</script>